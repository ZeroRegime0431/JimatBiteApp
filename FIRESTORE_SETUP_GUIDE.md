# Firestore Setup Guide - JimatBite App

## âœ… What's Already Implemented

### Authentication & User Profiles
- âœ… Firebase Authentication with email/password
- âœ… User profile creation and updates
- âœ… Profile data synced across sidebar and MyProfile page

### Payment Methods
- âœ… Save payment cards to Firestore (last 4 digits only for security)
- âœ… List all saved cards
- âœ… Remove payment methods
- âœ… Maximum 5 cards limit
- âœ… Validation for card data

### Cart Management
- âœ… Save cart items to Firestore
- âœ… Load cart on sidebar open
- âœ… Update quantities (increment/decrement)
- âœ… Remove items from cart
- âœ… Calculate subtotal, tax, delivery fees
- âœ… Real-time cart persistence

---

## ğŸ“Š Firestore Data Structure

### 1. Creating Collections in Firebase Console

#### Step 1: Access Firestore
1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select your "jimatbite" project
3. Click **"Firestore Database"** in the left menu
4. You should see your database (already created)

#### Step 2: Create Collections

**IMPORTANT:** Collections in Firestore are created automatically when you add the first document. However, you can create them manually for testing:

### Collection: `users`
Stores user profile information.

**Create First Document:**
1. Click **"Start collection"**
2. Collection ID: `users`
3. Document ID: Use your actual Firebase Auth user ID (auto-generated)
4. Add fields:

```
Field Name          | Type      | Value (Example)
--------------------|-----------|----------------------------------
uid                 | string    | "abc123..." (auto from Auth)
fullName            | string    | "John Doe"
email               | string    | "john@example.com"
mobileNumber        | string    | "+60123456789" (optional)
dateOfBirth         | string    | "1990-01-15" (optional)
photoURL            | string    | "" (empty for now)
addresses           | array     | [] (empty array)
createdAt           | timestamp | (click "use timestamp")
updatedAt           | timestamp | (click "use timestamp")
```

**Auto-Generated by App:** When users sign up, this data is created automatically.

---

### Collection: `menuItems`
Stores food items, drinks, desserts, etc.

**Create Documents Manually:**
1. Click **"Start collection"** (or Add document if collection exists)
2. Collection ID: `menuItems`
3. Auto-generate document ID (or use custom)
4. Add fields:

```
Field Name          | Type      | Value (Example)
--------------------|-----------|----------------------------------
id                  | string    | Same as document ID
name                | string    | "Strawberry Shake"
description         | string    | "Fresh strawberry milkshake with cream"
price               | number    | 20.00
category            | string    | "drink" (meal/dessert/drink/vegan/blindbox)
imageURL            | string    | "" (add after uploading image)
restaurantId        | string    | "rest-001"
restaurantName      | string    | "Sweet Delights"
rating              | number    | 4.5 (optional)
isAvailable         | boolean   | true
createdAt           | timestamp | (click "use timestamp")
```

**Example Menu Items to Create:**

**Item 1: Strawberry Shake**
```json
{
  "id": "menu-001",
  "name": "Strawberry Shake",
  "description": "Fresh strawberry milkshake with whipped cream",
  "price": 20.00,
  "category": "drink",
  "imageURL": "",
  "restaurantId": "rest-001",
  "restaurantName": "Sweet Delights",
  "rating": 4.8,
  "isAvailable": true,
  "createdAt": [current timestamp]
}
```

**Item 2: Broccoli Lasagna**
```json
{
  "id": "menu-002",
  "name": "Broccoli Lasagna",
  "description": "Vegetarian lasagna with fresh broccoli and cheese",
  "price": 12.00,
  "category": "meal",
  "imageURL": "",
  "restaurantId": "rest-001",
  "restaurantName": "Green Kitchen",
  "rating": 4.5,
  "isAvailable": true,
  "createdAt": [current timestamp]
}
```

**Item 3: Chocolate Cake**
```json
{
  "id": "menu-003",
  "name": "Chocolate Cake",
  "description": "Rich chocolate fudge cake with layers",
  "price": 15.00,
  "category": "dessert",
  "imageURL": "",
  "restaurantId": "rest-002",
  "restaurantName": "Cake Paradise",
  "rating": 4.9,
  "isAvailable": true,
  "createdAt": [current timestamp]
}
```

---

### Collection: `carts`
**Auto-managed by app** - No need to create manually.
- Document ID = User ID
- Contains user's cart items

---

### Collection: `orders`
**Auto-created** when user completes checkout.
- Auto-generated document ID
- Stores order history

Example structure:
```json
{
  "id": "order-abc123",
  "userId": "user-uid",
  "items": [...cart items...],
  "totalAmount": 52.00,
  "deliveryFee": 3.00,
  "tax": 5.00,
  "grandTotal": 60.00,
  "status": "pending",
  "deliveryAddress": {...},
  "paymentMethod": "card-xyz",
  "orderDate": [timestamp],
  "restaurantId": "rest-001",
  "restaurantName": "Sweet Delights"
}
```

---

### Collection: `paymentMethods`
**Auto-created by app** when users add cards.
- Stores last 4 digits only (secure)
- Auto-generated document ID

---

### Collection: `reviews`
**Auto-created by app** when users submit reviews for completed orders.
- Auto-generated document ID
- Allows users to rate and review menu items

Example structure:
```json
{
  "id": "review-abc123",
  "userId": "user-uid",
  "orderId": "order-abc123",
  "menuItemId": "menu-001",
  "menuItemName": "Chicken Curry",
  "rating": 5,
  "comment": "Absolutely delicious! Best curry I've had.",
  "createdAt": [timestamp]
}
```

**Features:**
- Users can review each item in a completed order
- Multiple items in one order = multiple reviews (one per item)
- Ratings: 1-5 stars
- Duplicate reviews prevented per user/order/item combination

---

## ğŸ“· Uploading Product Images to Firebase Storage

### Method 1: Using Firebase Console (Easiest)

#### Step 1: Access Firebase Storage
1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select your project
3. Click **"Storage"** in the left menu
4. You should see your storage bucket

#### Step 2: Create Folder Structure
1. Click **"Create folder"**
2. Create these folders:
   - `menu-items/` - For food/drink images
   - `restaurants/` - For restaurant logos
   - `profile-pictures/` - For user avatars

#### Step 3: Upload Images
1. Click on `menu-items/` folder
2. Click **"Upload file"**
3. Select image from your computer
4. Wait for upload to complete

#### Step 4: Get Image URL
1. Click on the uploaded image
2. Click **"Get download URL"** or look for the URL in file details
3. Copy the URL (looks like: `https://firebasestorage.googleapis.com/...`)

#### Step 5: Add URL to Firestore
1. Go back to **Firestore Database**
2. Find the menu item document
3. Edit the `imageURL` field
4. Paste the copied URL
5. Save

**Example:**
```
imageURL: "https://firebasestorage.googleapis.com/v0/b/jimatbite.firebasestorage.app/o/menu-items%2Fstrawberry-shake.jpg?alt=media&token=abc123..."
```

---

### Method 2: Using Code (Advanced)

**Note:** Your app already has storage initialized. To upload from the app:

```typescript
import { ref, uploadBytes, getDownloadURL } from 'firebase/storage';
import { storage } from '../config/firebase';

// Upload image
const uploadImage = async (uri: string, path: string) => {
  const response = await fetch(uri);
  const blob = await response.blob();
  
  const storageRef = ref(storage, path);
  await uploadBytes(storageRef, blob);
  
  const downloadURL = await getDownloadURL(storageRef);
  return downloadURL;
};

// Usage:
const imageUrl = await uploadImage(
  localImageUri, 
  'menu-items/strawberry-shake.jpg'
);
```

---

## ğŸ¯ Testing Your Setup

### Test 1: User Profile
1. Sign up with a new account in your app
2. Go to Firebase Console > Firestore > `users` collection
3. You should see a new document with your user data

### Test 2: Payment Methods
1. In your app, go to Payment Methods
2. Add a new card (use test data)
3. Go to Firestore > `paymentMethods` collection
4. You should see your card (last 4 digits only)

### Test 3: Cart
1. Add items to cart in your app
2. Go to Firestore > `carts` collection
3. Find document with your user ID
4. You should see cart items and total

---

## ğŸ“ Sample Data for Testing

### Create 5 Menu Items (One for Each Category)

**1. MEAL - Nasi Lemak**
```
name: "Nasi Lemak Special"
description: "Traditional Malaysian rice dish with sambal, egg, and chicken"
price: 18.50
category: "meal"
restaurantName: "Warung Pak Ali"
rating: 4.7
isAvailable: true
```

**2. DESSERT - Mango Pudding**
```
name: "Mango Pudding"
description: "Smooth mango pudding with fresh fruit toppings"
price: 8.50
category: "dessert"
restaurantName: "Sweet Paradise"
rating: 4.6
isAvailable: true
```

**3. DRINK - Teh Tarik**
```
name: "Teh Tarik"
description: "Malaysian pulled tea, sweet and frothy"
price: 4.50
category: "drink"
restaurantName: "Mamak Corner"
rating: 4.8
isAvailable: true
```

**4. VEGAN - Buddha Bowl**
```
name: "Buddha Bowl"
description: "Quinoa, roasted veggies, hummus, and tahini dressing"
price: 22.00
category: "vegan"
restaurantName: "Green Leaf"
rating: 4.9
isAvailable: true
```

**5. BLINDBOX - Mystery Meal**
```
name: "Surprise Mystery Box"
description: "Chef's special surprise meal - could be anything!"
price: 15.00
category: "blindbox"
restaurantName: "Mystery Kitchen"
rating: 4.4
isAvailable: true
```

---

## ğŸ”§ Firebase Storage Rules (Security)

### Current Rules (Test Mode)
Your storage is probably in **test mode** which allows all reads/writes. This is fine for development.

### Production Rules (Before Launch)
Update Storage Rules in Firebase Console:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Allow authenticated users to upload profile pictures
    match /profile-pictures/{userId}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow anyone to read menu images, but only admins to upload
    match /menu-items/{fileName} {
      allow read: if true;
      allow write: if false; // Only upload via admin panel or Firebase Console
    }
    
    // Restaurant images - read by all, write restricted
    match /restaurants/{fileName} {
      allow read: if true;
      allow write: if false;
    }
  }
}
```

---

## ğŸ¨ Image Recommendations

### Image Sizes:
- **Menu Items:** 800x600px (landscape)
- **Profile Pictures:** 400x400px (square)
- **Restaurant Logos:** 500x500px (square)

### File Formats:
- Use **JPG** for photos (smaller file size)
- Use **PNG** for logos (transparent background)
- Keep file size under 500KB

### Where to Get Images:
- [Unsplash](https://unsplash.com) - Free high-quality food photos
- [Pexels](https://pexels.com) - Free stock photos
- [Pixabay](https://pixabay.com) - Free images

---

## ğŸš€ Next Steps

1. **Create menu items** in Firestore with the examples above
2. **Upload images** to Storage and link URLs
3. **Test the app** - items should appear in category screens
4. **Add more restaurants** and menu items
5. **Test cart and checkout** flow
6. **Implement order tracking** (already prepared in database.ts)

---

## ğŸ“± App Features Using Firestore

### Currently Active:
- âœ… User authentication and profiles
- âœ… Payment method management
- âœ… Cart with real-time sync
- âœ… Profile editing

### Ready to Use (need UI updates):
- ğŸ“¦ Order creation (`createOrder`)
- ğŸ“¦ Order history (`getUserOrders`)
- ğŸ“¦ Menu item fetching (`getMenuItems`)
- ğŸ“¦ Order status updates (`updateOrderStatus`)

### To Implement:
- ğŸ”¨ Category screens to fetch real menu items
- ğŸ”¨ Search functionality
- ğŸ”¨ Order tracking page
- ğŸ”¨ Delivery address management
- ğŸ”¨ Restaurant listing

---

## â“ Troubleshooting

### Issue: "Permission denied" error
**Solution:** Check Firestore Rules - Make sure your rules allow authenticated users to read and write:
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow authenticated users to read/write their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow authenticated users to read/write their own cart
    match /carts/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow authenticated users to read/write their own payment methods
    match /paymentMethods/{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Allow authenticated users to read menu items
    match /menuItems/{document=**} {
      allow read: if true;
      allow write: if false; // Only admins
    }
    
    // Allow authenticated users to read/write their own orders
    match /orders/{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Allow authenticated users to read/write their own favorites
    match /favorites/{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Allow authenticated users to read/write reviews
    match /reviews/{reviewId} {
      allow read: if true; // Anyone can read reviews
      allow create: if request.auth != null; // Only authenticated users can create
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.userId; // Only review owner can edit/delete
    }
  }
}
```

### Issue: Images not loading
**Solution:** 
1. Check if image URL is correct in Firestore
2. Verify Storage Rules allow read access
3. Check if image exists in Storage bucket

### Issue: Cart not saving
**Solution:**
1. Ensure user is logged in (check `getCurrentUser()`)
2. Verify Firestore collection name is `carts`
3. Check browser console for errors

---

## ğŸ“ Need Help?

- [Firestore Documentation](https://firebase.google.com/docs/firestore)
- [Firebase Storage Guide](https://firebase.google.com/docs/storage)
- [React Native Firebase](https://rnfirebase.io)

---

**Your Firestore is now ready! ğŸ‰**

All payment methods and cart items are now stored securely in the cloud!
